<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Limbo&#39;s Wiki</title>
  
  
  <link href="/wiki/atom.xml" rel="self"/>
  
  <link href="http://taizilongxu.github.io/wiki/"/>
  <updated>2020-08-02T16:49:35.000Z</updated>
  <id>http://taizilongxu.github.io/wiki/</id>
  
  <author>
    <name>Limbo</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>LDAP</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/%E6%9D%82%E9%A1%B9/ldap/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/%E6%9D%82%E9%A1%B9/ldap/</id>
    <published>2020-08-02T16:49:35.000Z</published>
    <updated>2020-08-02T16:49:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>LDAP (Lightweight Directory Access Protocol) è½»å‹ç›®å½•è®¿é—®<strong>åè®®</strong></p><p>ä¸»è¦ç”¨äºå•ç‚¹ç™»å½•(SSO)</p><h2 id="ä¸¤ç§å®ç°"><a href="#ä¸¤ç§å®ç°" class="headerlink" title="ä¸¤ç§å®ç°"></a>ä¸¤ç§å®ç°</h2><p>OpenLDAP å’Œ ActiveDirectory(å¾®è½¯çš„åŸŸæ§åˆ¶å™¨)</p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><ol><li>ç›®å½•æ ‘: ç›®å½•æœåŠ¡ä¸ºæ ‘å½¢</li><li>æ¡ç›®: æ¯ä¸ªè®°å½•å«åšæ¡ç›®, æ¯ä¸ªæ¡ç›®åˆå”¯ä¸€çš„å¯åŒºåˆ«åç§°(distinguished name, DN)</li><li>å¯¹è±¡ç±»: ç±»æ¯”è¯­è¨€ä¸­çš„ class</li><li>å±æ€§: ç±»æ¯”è¯­è¨€é‡çš„ç±»å±æ€§</li></ol><h2 id="ç›®å½•æ ‘ç»“æ„"><a href="#ç›®å½•æ ‘ç»“æ„" class="headerlink" title="ç›®å½•æ ‘ç»“æ„"></a>ç›®å½•æ ‘ç»“æ„</h2><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/ldap_tree.png" alt=""></p><h2 id="LDAP-å±æ€§"><a href="#LDAP-å±æ€§" class="headerlink" title="LDAP å±æ€§"></a>LDAP å±æ€§</h2><table><thead><tr><th align="center">å±æ€§</th><th align="center">è‹±æ–‡</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">DC</td><td align="center">Domain Component</td><td align="center">åŸŸåçš„éƒ¨åˆ†ï¼Œå…¶æ ¼å¼æ˜¯å°†å®Œæ•´çš„åŸŸååˆ†æˆå‡ éƒ¨åˆ†ï¼Œå¦‚åŸŸåä¸ºexample.comå˜æˆdc=example,dc=comï¼ˆä¸€æ¡è®°å½•çš„æ‰€å±ä½ç½®ï¼‰</td></tr><tr><td align="center">UID</td><td align="center">User Id</td><td align="center">ç”¨æˆ·ID songtao.xuï¼ˆä¸€æ¡è®°å½•çš„IDï¼‰</td></tr><tr><td align="center">OU</td><td align="center">Organization Unit</td><td align="center">ç»„ç»‡å•ä½ï¼Œç»„ç»‡å•ä½å¯ä»¥åŒ…å«å…¶ä»–å„ç§å¯¹è±¡ï¼ˆåŒ…æ‹¬å…¶ä»–ç»„ç»‡å•å…ƒï¼‰ï¼Œå¦‚â€œoaç»„â€ï¼ˆä¸€æ¡è®°å½•çš„æ‰€å±ç»„ç»‡ï¼‰</td></tr><tr><td align="center">CN</td><td align="center">Common Name</td><td align="center">å…¬å…±åç§°ï¼Œå¦‚â€œThomas Johanssonâ€ï¼ˆä¸€æ¡è®°å½•çš„åç§°ï¼‰</td></tr><tr><td align="center">DN</td><td align="center">Distinguished Name</td><td align="center">â€œuid=songtao.xu,ou=oaç»„,dc=example,dc=comâ€ï¼Œä¸€æ¡è®°å½•çš„ä½ç½®ï¼ˆå”¯ä¸€ï¼‰</td></tr></tbody></table><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>å¤§è‡´è¯´ä¸‹åŸç†, æ— éå°±æ˜¯æ ¹æ®æ ‘å½¢ç»“æ„æ£€ç´¢è¦æŸ¥è¯¢çš„ç”¨æˆ·æ¯”å¯¹å¯†ç , </p><p>ä¸€èˆ¬ç¨‹åºä¼šè®¾ç½®ä¸€ä¸ª baseDN, æ˜¯æ•´ä¸ª LDAP ç®¡ç†è€…è´¦å·çš„ä¿¡æ¯</p><p>ç„¶åä¼šè®¾ç½®ä¸€ä¸ª userDN, æ˜¯æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ ‘ç»“æ„åœ°å€, è¿™ä¸¤ä¸ªåœ°å€èŠ‚ç‚¹è¶Šå¤šä»£è¡¨æœç´¢èŒƒå›´è¶Šå°,</p><p>è¿˜ä¼šæœ‰ä¸€ä¸ªç”¨æˆ·ç»„ group æŸ¥è¯¢, è¿™3ä¸ªéƒ½å·®ä¸å¤š</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;LDAP (Lightweight Directory Access Protocol) è½»å‹ç›®å½•è®¿é—®&lt;strong&gt;åè®®&lt;/strong&gt;
      
    
    </summary>
    
    
      <category term="æ‚é¡¹" scheme="http://taizilongxu.github.io/wiki/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
  </entry>
  
  <entry>
    <title>å¨å£«å¿Œ</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/%E7%94%9F%E6%B4%BB/whiskey/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/%E7%94%9F%E6%B4%BB/whiskey/</id>
    <published>2020-08-02T16:28:10.000Z</published>
    <updated>2020-08-02T16:28:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¨å£«å¿Œ:</p><ul><li>é…¿é€ åŸæ–™å¿…é¡»æ˜¯è°·ç‰©, æ¯”å¦‚å¤§éº¦</li><li>ä¸€å®šæ˜¯è’¸é¦é…’</li><li>å¿…é¡»åœ¨æ©¡æœ¨æ¡¶ç§é™ˆå¹´å‚¨è—</li></ul><p>æŒ‰åŸæ–™åˆ†ç±»:</p><ul><li>å•ä¸€éº¦èŠ½ Single Malt: åªç”¨æ°´å’Œå¤§éº¦éº¦èŠ½, ä¸åŠ ä»»ä½•è°·ç‰©</li><li>å•ä¸€è°·ç‰© Single Grain: é™¤äº†å¤§éº¦åŠ å…¥å…¶ä»–è°·ç‰©, ä¾‹å¦‚ç‰ç±³, å°éº¦æˆ–è€…æœªåšå‘èŠ½å¤„ç†çš„å¤§éº¦</li><li>è°ƒå’Œçº¯éº¦ Blended Malt: è‡³å°‘ä¸¤ä¸ªå•ä¸€éº¦èŠ½</li><li>è°ƒå’Œè°·ç‰© Blended Grain: è‡³å°‘ä¸¤å®¶å•ä¸€è°·ç‰©</li><li>è°ƒå’Œ Blended: è‡³å°‘ä¸€ç§å•ä¸€è°·ç‰©å’Œè‡³å°‘ä¸€ç§å•ä¸€éº¦èŠ½</li></ul><p>æŒ‰äº§åœ°åˆ†ç±»:</p><ul><li>è‹±æ ¼å…°</li><li>è‹æ ¼å…°</li><li>ç¾å›½</li><li>åŠ æ‹¿å¤§</li><li>æ—¥æœ¬</li></ul><h2 id="å¹³æ°‘é…’"><a href="#å¹³æ°‘é…’" class="headerlink" title="å¹³æ°‘é…’"></a>å¹³æ°‘é…’</h2><table><thead><tr><th>äº§åœ°</th><th>å“ç‰Œ</th><th>å®¹é‡</th><th>ç§ç±»</th><th>ä»·æ ¼</th><th>å£æ„Ÿ</th></tr></thead><tbody><tr><td>è‹æ ¼å…°</td><td>æ ¼å…° Grantâ€™s é›ªè‰çè—</td><td>700ml</td><td>è°ƒå’Œå¨å£«å¿Œ</td><td>60</td><td>å£ç²®é…’, å•å–ä¸é”™, æ³¥ç…¤åŠ é›ªè‰</td></tr><tr><td>è‹æ ¼å…°</td><td>ç™¾é¾„å› Ballantineâ€™s ç‰¹çº¯</td><td>500ml</td><td>è°ƒå’Œå¨å£«å¿Œ</td><td>50</td><td>å•å–ä¸å¥½å–, å¯èƒ½å¾—å…‘ç‚¹ä¸œè¥¿</td></tr><tr><td>è‹æ ¼å…°</td><td>é«˜å¸ä»¤ High Commissioner</td><td>200ml</td><td>è°ƒå’Œçº¯éº¦</td><td>20</td><td>å£ç²®é…’, ä¸€èˆ¬, ä¾¿å®œ</td></tr><tr><td>è‹±æ ¼å…°</td><td>å°Šå°¼è·åŠ  Johnnie Walker é»‘æ–¹</td><td>700ml</td><td>è°ƒå’Œå¨å£«å¿Œ</td><td></td><td></td></tr><tr><td>è‹±æ ¼å…°</td><td>å°Šå°¼è·åŠ  Johnnie Walker ç»¿æ–¹</td><td>700ml</td><td>è°ƒå’Œå¨å£«å¿Œ</td><td></td><td></td></tr><tr><td>è‹±æ ¼å…°</td><td>å°Šå°¼è·åŠ  Johnnie Walker çº¢æ–¹</td><td>700ml</td><td>è°ƒå’Œå¨å£«å¿Œ</td><td></td><td></td></tr><tr><td>è‹±æ ¼å…°</td><td>å°Šå°¼è·åŠ  Johnnie Walker ç»¿æ–¹</td><td>700ml</td><td>è°ƒå’Œå¨å£«å¿Œ</td><td></td><td></td></tr><tr><td>ç¾å›½ç”°çº³è¥¿</td><td>æ°å…‹ä¸¹å°¼ Jack Danielâ€™s</td><td>700ml</td><td>è°ƒå’Œå¨å£«å¿Œ</td><td>110</td><td></td></tr><tr><td>å°æ¹¾</td><td>é‡‘è½¦å™¶ç›å…° KAVALAN çé€‰</td><td>700ml</td><td>å•ä¸€éº¦èŠ½</td><td>200</td><td>ä¸å¤ªå–œæ¬¢, æœ‰ç‚¹çƒˆ</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¨å£«å¿Œ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é…¿é€ åŸæ–™å¿…é¡»æ˜¯è°·ç‰©, æ¯”å¦‚å¤§éº¦&lt;/li&gt;
&lt;li&gt;ä¸€å®šæ˜¯è’¸é¦é…’&lt;/li&gt;
&lt;li&gt;å¿…é¡»åœ¨æ©¡æœ¨æ¡¶ç§é™ˆå¹´å‚¨è—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŒ‰åŸæ–™åˆ†ç±»:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•ä¸€éº¦èŠ½ Single Malt: åªç”¨æ°´å’Œå¤§éº¦éº¦èŠ½, ä¸åŠ ä»»ä½•
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="http://taizilongxu.github.io/wiki/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>Helmet</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/%E7%94%9F%E6%B4%BB/helmet/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/%E7%94%9F%E6%B4%BB/helmet/</id>
    <published>2020-08-02T16:27:22.000Z</published>
    <updated>2020-08-02T16:27:22.000Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th align="center">å“ç‰Œ</th><th align="center">å‹å·</th><th align="center">åˆå</th><th align="center">é‡é‡</th><th align="center">Snell è®¤è¯</th><th align="center">Sharp è®¤è¯</th><th align="center">ä»·æ ¼</th></tr></thead><tbody><tr><td align="center">Shoei</td><td align="center">x14</td><td align="center"></td><td align="center">1400+-50g</td><td align="center">âˆš</td><td align="center"></td><td align="center">4280/5000</td></tr><tr><td align="center"></td><td align="center">z7</td><td align="center">NXR</td><td align="center">1310~1470g</td><td align="center"></td><td align="center">â­â­â­â­</td><td align="center">2780/3250</td></tr><tr><td align="center"></td><td align="center">GT-AIR</td><td align="center"></td><td align="center">1615g</td><td align="center"></td><td align="center">â­â­â­</td><td align="center"></td></tr><tr><td align="center">Arai</td><td align="center">rx7x</td><td align="center">rx-7v</td><td align="center"></td><td align="center">âˆš</td><td align="center"></td><td align="center">3380/3900</td></tr><tr><td align="center"></td><td align="center">xd</td><td align="center"></td><td align="center">1595-1675g</td><td align="center">âˆš</td><td align="center"></td><td align="center">3100/3700</td></tr><tr><td align="center"></td><td align="center">Quantum</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">â­â­â­</td><td align="center"></td></tr><tr><td align="center">Hjc</td><td align="center">RPHA11</td><td align="center"></td><td align="center">1350+-50g</td><td align="center"></td><td align="center">â­â­â­</td><td align="center">4500</td></tr><tr><td align="center"></td><td align="center">c70</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">â­â­â­â­â­</td><td align="center"></td></tr><tr><td align="center"></td><td align="center">i70</td><td align="center"></td><td align="center">1600+-50g</td><td align="center"></td><td align="center">â­â­â­â­</td><td align="center">1400</td></tr></tbody></table><p>snell è®¤è¯: <a href="https://www.smf.org/cert" target="_blank" rel="noopener">https://www.smf.org/cert</a></p><p>sharp è®¤è¯: <a href="https://sharp.dft.gov.uk/" target="_blank" rel="noopener">https://sharp.dft.gov.uk/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;å“ç‰Œ&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;å‹å·&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;åˆå&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;é‡é‡&lt;/th&gt;
&lt;th align=&quot;
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="http://taizilongxu.github.io/wiki/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>auth</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/auth/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/auth/</id>
    <published>2020-06-23T07:33:47.050Z</published>
    <updated>2020-06-23T07:37:39.441Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>Authentication(é‰´å®š): Kerberros</p></li><li><p>User/Group Mapping:  LDAP</p></li><li><p>Authorization(æˆæƒ): Ranger</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;&lt;p&gt;Authentication(é‰´å®š): Kerberros&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;User/Group Mapping:  LDAP&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Authorization(æˆæƒ): Ranger&lt;/p&gt;
&lt;/li&gt;
&lt;/
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>zookeeper</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/zookeeper/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/zookeeper/</id>
    <published>2020-06-03T06:28:36.612Z</published>
    <updated>2020-07-09T04:21:45.480Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>hbase</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/hbase/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/hbase/</id>
    <published>2020-06-03T06:28:32.013Z</published>
    <updated>2020-06-05T13:11:14.787Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™:</p><ul><li><a href="http://iambigboss.top/post/72413_1_1.html" target="_blank" rel="noopener">http://iambigboss.top/post/72413_1_1.html</a></li><li><a href="https://cshihong.github.io/2018/05/17/HBaseæŠ€æœ¯åŸç†/" target="_blank" rel="noopener">https://cshihong.github.io/2018/05/17/HBase%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‚è€ƒèµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://iambigboss.top/post/72413_1_1.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://iambigboss.top/post/72413_1_
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>åšç‰©é¦†</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/%E7%94%9F%E6%B4%BB/museum/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/%E7%94%9F%E6%B4%BB/museum/</id>
    <published>2020-06-01T05:11:43.489Z</published>
    <updated>2020-06-01T05:19:50.045Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th>åç§°</th><th>ç½‘å€</th><th></th></tr></thead><tbody><tr><td>ä¸­å›½å›­æ—åšç‰©é¦†</td><td><a href="http://www.gardensmuseum.cn/" target="_blank" rel="noopener">http://www.gardensmuseum.cn/</a></td><td></td></tr><tr><td>ä¸­å›½å›½å®¶åšç‰©é¦†</td><td><a href="http://www.chnmuseum.cn/" target="_blank" rel="noopener">http://www.chnmuseum.cn/</a></td><td></td></tr><tr><td>æ•…å®«åšç‰©é™¢</td><td><a href="https://www.dpm.org.cn/" target="_blank" rel="noopener">https://www.dpm.org.cn/</a></td><td></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;ç½‘å€&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;ä¸­å›½å›­æ—åšç‰©é¦†&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;http://www.gardensmuseum.cn/
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="http://taizilongxu.github.io/wiki/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>LVS(Linux Virtual Server)</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/lvs/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/lvs/</id>
    <published>2020-05-03T18:42:14.000Z</published>
    <updated>2020-07-09T04:21:05.783Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™:</p><ul><li><a href="https://www.cnblogs.com/walkman-sky/p/12197805.html" target="_blank" rel="noopener">https://www.cnblogs.com/walkman-sky/p/12197805.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‚è€ƒèµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/walkman-sky/p/12197805.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblogs.com/w
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Network/virtual_IP_address/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Network/virtual_IP_address/</id>
    <published>2020-05-03T18:41:29.000Z</published>
    <updated>2020-06-01T12:29:07.639Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™:</p><ul><li><a href="https://www.zhihu.com/question/67682565" target="_blank" rel="noopener">https://www.zhihu.com/question/67682565</a></li><li><a href="http://xiaobaoqiu.github.io/blog/2015/04/02/xu-ni-iphe-ippiao-yi/" target="_blank" rel="noopener">http://xiaobaoqiu.github.io/blog/2015/04/02/xu-ni-iphe-ippiao-yi/</a></li></ul><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/20200504014915.png" alt=""></p><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/20200504014937.png" alt=""></p><h2 id="è™šæ‹Ÿ-IP"><a href="#è™šæ‹Ÿ-IP" class="headerlink" title="è™šæ‹Ÿ IP"></a>è™šæ‹Ÿ IP</h2><p>åªæ˜¯é€šè¿‡ ARP åè®®åè°ƒè·¯ç”±è¾¾åˆ°ä¸»å¤‡åˆ‡æ¢</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‚è€ƒèµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zhihu.com/question/67682565&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.zhihu.com/question/676825
      
    
    </summary>
    
    
      <category term="Network" scheme="http://taizilongxu.github.io/wiki/categories/Network/"/>
    
    
  </entry>
  
  <entry>
    <title>python å†…å­˜</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythonMemory/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythonMemory/</id>
    <published>2020-05-03T17:34:48.000Z</published>
    <updated>2020-05-03T17:34:48.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p><a href="https://docs.python.org/3/c-api/memory.html" target="_blank" rel="noopener">https://docs.python.org/3/c-api/memory.html</a></p></li><li><p><a href="https://realpython.com/python-memory-management/" target="_blank" rel="noopener">https://realpython.com/python-memory-management/</a></p></li><li><p><a href="https://rushter.com/blog/python-memory-managment/" target="_blank" rel="noopener">https://rushter.com/blog/python-memory-managment/</a></p></li><li><p><a href="https://github.com/zpoint/CPython-Internals/blob/master/Interpreter/memory_management/memory_management_cn.md" target="_blank" rel="noopener">https://github.com/zpoint/CPython-Internals/blob/master/Interpreter/memory_management/memory_management_cn.md</a></p></li></ul><p><a href="https://github.com/python/cpython/blob/ad051cbce1360ad3055a048506c09bc2a5442474/Objects/obmalloc.c#L534" target="_blank" rel="noopener">ä»£ç </a></p><h2 id="å†…å­˜æ± æœºåˆ¶"><a href="#å†…å­˜æ± æœºåˆ¶" class="headerlink" title="å†…å­˜æ± æœºåˆ¶"></a>å†…å­˜æ± æœºåˆ¶</h2><ul><li>å¤§å†…å­˜ä½¿ç”¨ malloc åˆ†é…</li><li>å°å†…å­˜ä½¿ç”¨å†…å­˜æ± åˆ†é…</li><li>Python å†…å­˜æ± <ul><li>ç¬¬3å±‚: æœ€ä¸Šå±‚, ç”¨æˆ·å¯¹ Python å¯¹è±¡æ“ä½œ</li><li>ç¬¬1/2å±‚: å†…å­˜æ± ï¼Œç”± Python çš„æ¥å£å‡½æ•° PyMem_Malloc å®ç°â€”â€“è‹¥è¯·æ±‚åˆ†é…çš„å†…å­˜åœ¨1~256å­—èŠ‚ä¹‹é—´å°±ä½¿ç”¨å†…å­˜æ± ç®¡ç†ç³»ç»Ÿè¿›è¡Œåˆ†é…ï¼Œè°ƒç”¨mallocå‡½æ•°åˆ†é…å†…å­˜ï¼Œä½†æ˜¯æ¯æ¬¡åªä¼šåˆ†é…ä¸€å—å¤§å°ä¸º256Kçš„å¤§å—å†…å­˜ï¼Œä¸ä¼šè°ƒç”¨freeå‡½æ•°é‡Šæ”¾å†…å­˜ï¼Œå°†è¯¥å†…å­˜å—ç•™åœ¨å†…å­˜æ± ä¸­ä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨ã€‚</li><li>ç¬¬ 0 å±‚: å¤§å†…å­˜, è‹¥è¯·æ±‚åˆ†é…çš„å†…å­˜å¤§äº256Kï¼Œmallocå‡½æ•°åˆ†é…å†…å­˜ï¼Œfreeå‡½æ•°é‡Šæ”¾å†…å­˜</li><li>ç¬¬ -1/-2 å±‚: æ“ä½œç³»ç»Ÿè¿›è¡Œæ“ä½œ</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/20200406072521.png" alt=""></p><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/20200406164728.png" alt=""></p><h3 id="ä¸‰å±‚ç»“æ„"><a href="#ä¸‰å±‚ç»“æ„" class="headerlink" title="ä¸‰å±‚ç»“æ„"></a>ä¸‰å±‚ç»“æ„</h3><ul><li>Arena: ç›´æ¥å‘ç³»ç»Ÿç”³è¯·ç©ºé—´</li><li>Pool: ç›¸åŒå¤§å° block é›†åˆ, æ€»å¤§å°å’Œç³»ç»Ÿ memory page ç›¸åŒ(4kb)</li><li>block: æœ€å°åˆ†é…å•ä½</li></ul><p>è¯´æ˜: Arena ä¼šä¸€æ¬¡æ€§åˆ›å»º 16 ä¸ª, æ¯ä¸ª Areana å« 64 ä¸ª pool</p><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_memory.png" alt=""></p><h2 id="åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="åƒåœ¾å›æ”¶æœºåˆ¶"></a>åƒåœ¾å›æ”¶æœºåˆ¶</h2><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_gc_xmind.png" alt=""></p><h3 id="å¼•ç”¨è®¡æ•°"><a href="#å¼•ç”¨è®¡æ•°" class="headerlink" title="å¼•ç”¨è®¡æ•°"></a>å¼•ç”¨è®¡æ•°</h3><p>ref += 1</p><h3 id="æ ‡è®°æ¸…é™¤"><a href="#æ ‡è®°æ¸…é™¤" class="headerlink" title="æ ‡è®°æ¸…é™¤"></a>æ ‡è®°æ¸…é™¤</h3><p>æ ¸å¿ƒåŸç†: </p><ul><li>æ ‡è®°é˜¶æ®µ: æ ‡è®°æ‰€æœ‰å¼•ç”¨ä¸º 1 çš„å¯¹è±¡ä¸º unreachable, ç„¶åå¯¹ä¸ä¸º 1 çš„å¯¹è±¡è¿›è¡Œè°ƒç”¨éå†,å¦‚æœè¢«å¼•ç”¨åˆ™å°†æ•´ä¸ªå¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡å¯¹è±¡ä» unreachable çŠ¶æ€å˜ä¸º reacheable </li><li>æ¸…é™¤é˜¶æ®µ: åˆ é™¤ unreachable å¯¹è±¡</li></ul><p><strong>ä¸Šé¢æè¿°çš„åƒåœ¾å›æ”¶çš„é˜¶æ®µï¼Œä¼šæš‚åœæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œç­‰å¾…æ ‡è®°æ¸…é™¤ç»“æŸåæ‰ä¼šæ¢å¤åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚</strong></p><h3 id="åˆ†ä»£å›æ”¶"><a href="#åˆ†ä»£å›æ”¶" class="headerlink" title="åˆ†ä»£å›æ”¶"></a>åˆ†ä»£å›æ”¶</h3><p>åœ¨ç¨‹åºé‡Œå­˜è´§æ—¶é—´è¶Šä¹…, æ‰«æè¶Šå°‘</p><p>åˆ†ä¸º 0, 1, 2 æ€»å…± 3 ä»£</p><p>æŸ¥çœ‹å’Œè°ƒæ•´å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gc.get_threshold() <span class="comment"># (threshold0, threshold1, threshold2).</span></span><br><span class="line">gc.set_threshold(threshold0[, threshold1[, threshold2]])</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://docs.python.org/3/c-api/memory.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://docs.python.org/3/c-api/memory.html
      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>Dict</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythoDict/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythoDict/</id>
    <published>2020-04-04T11:29:17.000Z</published>
    <updated>2020-04-04T11:29:17.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p><a href="https://www.python.org/dev/peps/pep-0412/" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-0412/</a></p></li><li><p><a href="https://flaggo.github.io/python3-source-code-analysis/objects/dict-object/" target="_blank" rel="noopener">https://flaggo.github.io/python3-source-code-analysis/objects/dict-object/</a></p></li><li><p><a href="https://www.slideshare.net/delimitry/python-dictionary-past-present-future" target="_blank" rel="noopener">https://www.slideshare.net/delimitry/python-dictionary-past-present-future</a></p></li><li><p><a href="https://github.com/zpoint/CPython-Internals/blob/master/BasicObject/dict/dict_cn.md" target="_blank" rel="noopener">https://github.com/zpoint/CPython-Internals/blob/master/BasicObject/dict/dict_cn.md</a></p></li></ul><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_dict.png" alt=""></p><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>ä»£ç ä½ç½®: <code>Include/cpython/dictobject.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject_HEAD</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Number of items in the dictionary */</span></span><br><span class="line">    Py_ssize_t ma_used;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Dictionary version: globally unique, value change each time</span></span><br><span class="line"><span class="comment">       the dictionary is modified */</span></span><br><span class="line">    <span class="keyword">uint64_t</span> ma_version_tag;</span><br><span class="line"></span><br><span class="line">    PyDictKeysObject *ma_keys;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* If ma_values is NULL, the table is "combined": keys and values</span></span><br><span class="line"><span class="comment">       are stored in ma_keys.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       If ma_values is not NULL, the table is splitted:</span></span><br><span class="line"><span class="comment">       keys are stored in ma_keys and values are stored in ma_values */</span></span><br><span class="line">    PyObject **ma_values;</span><br><span class="line">&#125; PyDictObject;</span><br></pre></td></tr></table></figure><p>ä»£ç ä½ç½®: <code>Objects/dict-common.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PyDictKeysObject</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">dictkeysobject</span> &#123;</span></span><br><span class="line">    Py_ssize_t dk_refcnt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Size of the hash table (dk_indices). It must be a power of 2. */</span></span><br><span class="line">    Py_ssize_t dk_size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Function to lookup in the hash table (dk_indices):</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - lookdict(): general-purpose, and may return DKIX_ERROR if (and</span></span><br><span class="line"><span class="comment">         only if) a comparison raises an exception.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - lookdict_unicode(): specialized to Unicode string keys, comparison of</span></span><br><span class="line"><span class="comment">         which can never raise an exception; that function can never return</span></span><br><span class="line"><span class="comment">         DKIX_ERROR.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - lookdict_unicode_nodummy(): similar to lookdict_unicode() but further</span></span><br><span class="line"><span class="comment">         specialized for Unicode string keys that cannot be the &lt;dummy&gt; value.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - lookdict_split(): Version of lookdict() for split tables. */</span></span><br><span class="line">    dict_lookup_func dk_lookup;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Number of usable entries in dk_entries. */</span></span><br><span class="line">    Py_ssize_t dk_usable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Number of used entries in dk_entries. */</span></span><br><span class="line">    Py_ssize_t dk_nentries;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Actual hash table of dk_size entries. It holds indices in dk_entries,</span></span><br><span class="line"><span class="comment">       or DKIX_EMPTY(-1) or DKIX_DUMMY(-2).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       Indices must be: 0 &lt;= indice &lt; USABLE_FRACTION(dk_size).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       The size in bytes of an indice depends on dk_size:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - 1 byte if dk_size &lt;= 0xff (char*)</span></span><br><span class="line"><span class="comment">       - 2 bytes if dk_size &lt;= 0xffff (int16_t*)</span></span><br><span class="line"><span class="comment">       - 4 bytes if dk_size &lt;= 0xffffffff (int32_t*)</span></span><br><span class="line"><span class="comment">       - 8 bytes otherwise (int64_t*)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       Dynamically sized, SIZEOF_VOID_P is minimum. */</span></span><br><span class="line">    <span class="keyword">char</span> dk_indices[];  <span class="comment">/* char is required to avoid strict aliasing. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* "PyDictKeyEntry dk_entries[dk_usable];" array follows:</span></span><br><span class="line"><span class="comment">       see the DK_ENTRIES() macro */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»£ç ä½ç½®: <code>Objects/dict-common.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="comment">/* Cached hash code of me_key. */</span></span><br><span class="line">    Py_hash_t me_hash;</span><br><span class="line">    PyObject *me_key;</span><br><span class="line">    PyObject *me_value; <span class="comment">/* This field is only meaningful for combined tables */</span></span><br><span class="line">&#125; PyDictKeyEntry</span><br></pre></td></tr></table></figure><h3 id="Typeç±»å‹"><a href="#Typeç±»å‹" class="headerlink" title="Typeç±»å‹"></a>Typeç±»å‹</h3><p>ä»£ç ä½ç½®: <code>Objects/dictobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">PyTypeObject PyDict_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"dict"</span>,</span><br><span class="line">    <span class="keyword">sizeof</span>(PyDictObject),</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    (destructor)dict_dealloc,                   <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_vectorcall_offset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_async */</span></span><br><span class="line">    (reprfunc)dict_repr,                        <span class="comment">/* tp_repr */</span></span><br><span class="line">    &amp;dict_as_number,                            <span class="comment">/* tp_as_number */</span></span><br><span class="line">    &amp;dict_as_sequence,                          <span class="comment">/* tp_as_sequence */</span></span><br><span class="line">    &amp;dict_as_mapping,                           <span class="comment">/* tp_as_mapping */</span></span><br><span class="line">    PyObject_HashNotImplemented,                <span class="comment">/* tp_hash */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_call */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_str */</span></span><br><span class="line">    PyObject_GenericGetAttr,                    <span class="comment">/* tp_getattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_buffer */</span></span><br><span class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC |</span><br><span class="line">        Py_TPFLAGS_BASETYPE | Py_TPFLAGS_DICT_SUBCLASS,         <span class="comment">/* tp_flags */</span></span><br><span class="line">    dictionary_doc,                             <span class="comment">/* tp_doc */</span></span><br><span class="line">    dict_traverse,                              <span class="comment">/* tp_traverse */</span></span><br><span class="line">    dict_tp_clear,                              <span class="comment">/* tp_clear */</span></span><br><span class="line">    dict_richcompare,                           <span class="comment">/* tp_richcompare */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_weaklistoffset */</span></span><br><span class="line">    (getiterfunc)dict_iter,                     <span class="comment">/* tp_iter */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_iternext */</span></span><br><span class="line">    mapp_methods,                               <span class="comment">/* tp_methods */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_members */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_base */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dict */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_descr_get */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_descr_set */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dictoffset */</span></span><br><span class="line">    dict_init,                                  <span class="comment">/* tp_init */</span></span><br><span class="line">    PyType_GenericAlloc,                        <span class="comment">/* tp_alloc */</span></span><br><span class="line">    dict_new,                                   <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_GC_Del,                            <span class="comment">/* tp_free */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="C-æ¥å£"><a href="#C-æ¥å£" class="headerlink" title="C æ¥å£"></a>C æ¥å£</h3><p>ä»£ç ä½ç½®: <code>Include/dictobject.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PyObject *</span><br><span class="line">PyDict_New(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">    dictkeys_incref(Py_EMPTY_KEYS);</span><br><span class="line">    <span class="keyword">return</span> new_dict(Py_EMPTY_KEYS, empty_values);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyDictKeysObject empty_keys_struct = &#123;</span><br><span class="line">        <span class="number">1</span>, <span class="comment">/* dk_refcnt */</span></span><br><span class="line">        <span class="number">1</span>, <span class="comment">/* dk_size */</span></span><br><span class="line">        lookdict_split, <span class="comment">/* dk_lookup */</span></span><br><span class="line">        <span class="number">0</span>, <span class="comment">/* dk_usable (immutable) */</span></span><br><span class="line">        <span class="number">0</span>, <span class="comment">/* dk_nentries */</span></span><br><span class="line">        &#123;DKIX_EMPTY, DKIX_EMPTY, DKIX_EMPTY, DKIX_EMPTY,</span><br><span class="line">         DKIX_EMPTY, DKIX_EMPTY, DKIX_EMPTY, DKIX_EMPTY&#125;, <span class="comment">/* dk_indices */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>åˆå§‹åŒ– dict å¤§å°ä¸º <code>8</code></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://www.python.org/dev/peps/pep-0412/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.python.org/dev/peps/pep-0412/&lt;/a&gt;
      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>é£Ÿæ</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/%E7%94%9F%E6%B4%BB/food/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/%E7%94%9F%E6%B4%BB/food/</id>
    <published>2020-04-03T16:26:47.000Z</published>
    <updated>2020-04-03T16:26:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¡¬ä»¶"><a href="#ç¡¬ä»¶" class="headerlink" title="ç¡¬ä»¶"></a>ç¡¬ä»¶</h2><ul><li>ç”µé¥­é”…</li><li>ç”µç£ç‚‰: ç±³å®¶ç”µç£ç‚‰é’æ˜¥ç‰ˆ</li><li>ç…é”…, é›ªå¹³é”…</li><li>å¨æˆ¿çº¸</li><li>ç §æ¿</li><li>åˆ€å…·: ä¸‰å¾·åˆ€åŸºæœ¬å¤Ÿç”¨, åæœŸå‡çº§å¯ä»¥åŠ ä¸ªåˆ‡ç‰‡åˆ€</li></ul><h2 id="æ‹Œæ–™"><a href="#æ‹Œæ–™" class="headerlink" title="æ‹Œæ–™"></a>æ‹Œæ–™</h2><ul><li>æ©„æ¦„æ²¹, PAMå–·æ²¹</li><li>é»‘èƒ¡æ¤’</li><li>å­œç„¶</li><li>ç›</li><li>é…±æ²¹</li><li>æ–™é…’</li><li>è€—æ²¹</li><li>å¡çœŸç²‰</li><li>è¿·è¿­é¦™</li></ul><h2 id="çƒ­é‡è®¡ç®—å…¬å¼"><a href="#çƒ­é‡è®¡ç®—å…¬å¼" class="headerlink" title="çƒ­é‡è®¡ç®—å…¬å¼"></a>çƒ­é‡è®¡ç®—å…¬å¼</h2><p>1å¤§å¡ = 4.184 åƒç„¦</p><h2 id="é£Ÿæ"><a href="#é£Ÿæ" class="headerlink" title="é£Ÿæ"></a>é£Ÿæ</h2><p>è›‹ç™½è´¨</p><table><thead><tr><th align="center">åç§°</th><th align="center">GI</th><th align="center">çƒ­é‡å¤§å¡</th><th align="center">å¸¸æ¸©å­˜å‚¨</th><th align="center">å†·è—å­˜å‚¨</th><th align="center">å†·å†»å­˜å‚¨</th></tr></thead><tbody><tr><td align="center">ç‰›è‚‰ğŸ‚</td><td align="center">46</td><td align="center">318</td><td align="center">2å°æ—¶</td><td align="center">1-2å¤©</td><td align="center">6-8æœˆ</td></tr><tr><td align="center">é¸¡èƒ¸è‚‰ğŸ“</td><td align="center">45</td><td align="center">200</td><td align="center">2å°æ—¶</td><td align="center">1-2å¤©</td><td align="center">1å¹´</td></tr><tr><td align="center">é¾™åˆ©é±¼ğŸŸ</td><td align="center">40</td><td align="center">67</td><td align="center">2å°æ—¶</td><td align="center">1-2å¤©</td><td align="center">6-9æœˆ</td></tr><tr><td align="center">é‡‘æªé±¼ğŸŸ</td><td align="center">40</td><td align="center">99</td><td align="center">2å°æ—¶</td><td align="center">1-2å¤©</td><td align="center">6-9æœˆ</td></tr><tr><td align="center">æ²™ä¸é±¼ğŸŸ</td><td align="center">40</td><td align="center">89</td><td align="center">2å°æ—¶</td><td align="center">1-2å¤©</td><td align="center">6-9æœˆ</td></tr><tr><td align="center">è™¾ä»ğŸ¤</td><td align="center">40</td><td align="center">83</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">é¸¡è›‹ğŸ¥š</td><td align="center">30</td><td align="center">151</td><td align="center">æ•°å°æ—¶</td><td align="center">3-4å‘¨</td><td align="center">ä¸å¯</td></tr><tr><td align="center">ç‰›å¥¶ğŸ¥›</td><td align="center">25</td><td align="center">67</td><td align="center">æ•°å°æ—¶</td><td align="center">5-7å¤©</td><td align="center">1ä¸ªæœˆ</td></tr><tr><td align="center">åŸ¹æ ¹ğŸ¥“</td><td align="center">49</td><td align="center">405</td><td align="center">2å°æ—¶</td><td align="center">2å‘¨</td><td align="center">4ä¸ªæœˆ</td></tr></tbody></table><p>è”¬èœ</p><table><thead><tr><th align="center">åç§°</th><th align="center">GI</th><th align="center">çƒ­é‡å¤§å¡</th><th align="center">å¸¸æ¸©å­˜å‚¨</th><th align="center">å†·è—å­˜å‚¨</th><th align="center">å†·å†»å­˜å‚¨</th></tr></thead><tbody><tr><td align="center">ç‰ç±³ğŸŒ½</td><td align="center">70</td><td align="center">92</td><td align="center">1-3å¤©</td><td align="center">1-2å‘¨</td><td align="center">3-5æœˆ</td></tr><tr><td align="center">çº¢èåœğŸ¥•</td><td align="center">80</td><td align="center">37</td><td align="center">4å¤©</td><td align="center">4-5å‘¨</td><td align="center">8-12æœˆ</td></tr><tr><td align="center">é©¬é“ƒè–¯ğŸ¥”</td><td align="center">90</td><td align="center">65</td><td align="center">1ä¸ªæœˆ</td><td align="center">3-4æœˆ</td><td align="center">ä¸å¯å†·å†»</td></tr><tr><td align="center">çº¢è–¯</td><td align="center">76</td><td align="center">61</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">å±±è¯</td><td align="center">75</td><td align="center">50</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">ç•ªèŒ„ğŸ…</td><td align="center">30</td><td align="center">19</td><td align="center">5-7å¤©</td><td align="center">2å‘¨</td><td align="center">8-12æœˆ</td></tr><tr><td align="center">é»„ç“œğŸ¥’</td><td align="center">23</td><td align="center">14</td><td align="center">1-3å¤©</td><td align="center">1å‘¨</td><td align="center">8-12æœˆ</td></tr><tr><td align="center">è¥¿å…°èŠ±ğŸ¥¦</td><td align="center">25</td><td align="center">36</td><td align="center">2å¤©</td><td align="center">7-14å¤©</td><td align="center">8-12æœˆ</td></tr><tr><td align="center">å—ç“œğŸƒ</td><td align="center">65</td><td align="center">91</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><p>ä¸»é£Ÿ</p><table><thead><tr><th align="center">åç§°</th><th align="center">GI</th><th align="center">çƒ­é‡å¤§å¡</th></tr></thead><tbody><tr><td align="center">ç±³é¥­ğŸš</td><td align="center">84</td><td align="center">356</td></tr><tr><td align="center">é¦’å¤´</td><td align="center">88</td><td align="center">233</td></tr><tr><td align="center">ç³™ç±³ğŸš</td><td align="center">56</td><td align="center">350</td></tr><tr><td align="center">ç‡•éº¦ğŸ¥£</td><td align="center">55</td><td align="center">380</td></tr><tr><td align="center">å…¨éº¦é¢åŒ…ğŸ</td><td align="center">50</td><td align="center">378</td></tr><tr><td align="center">é»‘éº¦é¢åŒ…ğŸ</td><td align="center">58</td><td align="center">264</td></tr><tr><td align="center">æ„å¤§åˆ©é¢ğŸ</td><td align="center">55</td><td align="center">378</td></tr><tr><td align="center">èéº¦é¢ğŸ</td><td align="center">59</td><td align="center">274</td></tr></tbody></table><p>æ°´æœ</p><table><thead><tr><th align="center">åç§°</th><th align="center">GI</th><th align="center">çƒ­é‡å¤§å¡</th><th align="center">å¸¸æ¸©å­˜å‚¨</th><th align="center">å†·è—å­˜å‚¨</th><th align="center">å†·å†»å­˜å‚¨</th></tr></thead><tbody><tr><td align="center">é¦™è•‰ğŸŒ</td><td align="center">55</td><td align="center">154</td><td align="center">2-7å¤©</td><td align="center">5-9å¤©</td><td align="center">2-3ä¸ªæœˆ</td></tr><tr><td align="center">èŠ’æœğŸ¥­</td><td align="center">49</td><td align="center">64</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">å“ˆå¯†ç“œğŸˆ</td><td align="center">41</td><td align="center">42</td><td align="center">ç†Ÿé€ä¹‹å‰</td><td align="center">1å‘¨</td><td align="center">8-12æœˆ</td></tr><tr><td align="center">æ¡ƒå­ğŸ‘</td><td align="center">41</td><td align="center">40</td><td align="center">ç†Ÿé€ä¹‹å‰</td><td align="center">2-5å¤©</td><td align="center">8-12ä¸ªæœˆ</td></tr><tr><td align="center">è‹¹æœğŸ</td><td align="center">36</td><td align="center">54</td><td align="center">2-4å‘¨</td><td align="center">1-2æœˆ</td><td align="center">8-12æœˆ</td></tr><tr><td align="center">å¥‡å¼‚æœğŸ¥</td><td align="center">35</td><td align="center">35</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">æ¢¨ğŸ</td><td align="center">32</td><td align="center">43</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">æœ¨ç“œ</td><td align="center">30</td><td align="center">38</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">æ©™å­ğŸŠ</td><td align="center">31</td><td align="center">46</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">æ©˜å­ğŸŠ</td><td align="center">31</td><td align="center">60</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center">æŸ æª¬ğŸ‹</td><td align="center">34</td><td align="center">54</td><td align="center">2-4å‘¨</td><td align="center">1-2æœˆ</td><td align="center">3-4æœˆ</td></tr><tr><td align="center">è‰è“ğŸ“</td><td align="center">29</td><td align="center">34</td><td align="center">1-2å¤©</td><td align="center">5-7å¤©</td><td align="center">6-8ä¸ªæœˆ</td></tr><tr><td align="center">è‘¡è„ğŸ‡</td><td align="center">50</td><td align="center">55</td><td align="center">3-5å¤©</td><td align="center">7-10å¤©</td><td align="center">3-5ä¸ªæœˆ</td></tr></tbody></table><h2 id="å¥èº«é¤"><a href="#å¥èº«é¤" class="headerlink" title="å¥èº«é¤"></a>å¥èº«é¤</h2><h3 id="ç‰›æ’"><a href="#ç‰›æ’" class="headerlink" title="ç‰›æ’"></a>ç‰›æ’</h3><p>ç´ æ</p><ul><li><p>ç‰›æ’</p></li><li><p>æ©„æ¦„æ²¹</p></li><li><p>é»‘èƒ¡æ¤’</p></li><li><p>ç›</p></li></ul><p>è¿‡ç¨‹</p><ol><li>å†·è—è§£å†», å®¤æ¸©è§£å†»æˆ–è€…å†·æ°´è§£å†»</li><li>ä¸ç”¨æ°´æ¸…æ´—, ç”¨å¨æˆ¿çº¸æ“¦å¹²æ°´åˆ†</li><li>å®¤æ¸©å›æ¸©è‡³å°‘ 30 min ä»¥ä¸Š, åšçš„ 1 å°æ—¶ä»¥ä¸Š</li><li>æŠ¹ä¸Šæ©„æ¦„æ²¹, ä¸¤é¢ç”¨é»‘èƒ¡æ¤’å’Œç›è°ƒå‘³</li><li>15s ä¸€æ¬¡ç¿»é¢</li><li>é†’è‚‰</li></ol><h3 id="ç”µé¥­é”…ç…®é¸¡è›‹"><a href="#ç”µé¥­é”…ç…®é¸¡è›‹" class="headerlink" title="ç”µé¥­é”…ç…®é¸¡è›‹"></a>ç”µé¥­é”…ç…®é¸¡è›‹</h3><p>ç´ æ</p><ul><li>é¸¡è›‹</li><li>æ°´</li></ul><p>è¿‡ç¨‹</p><ol><li><p>ç”µé¥­é”…é“ºä¸Šé¤å¨çº¸</p></li><li><p>å‡åŒ€æµ‡ä¸Š 100ml æ°´</p></li><li><p>ç­‰å¾…è·³é—¸åé—· 5 åˆ†é’Ÿ</p></li><li><p>æ‹¿å‡ºæ”¾å…¥å‡‰æ°´å†·å´å¥½æ‰’çš®</p></li></ol><h3 id="è’¸ç´«è–¯"><a href="#è’¸ç´«è–¯" class="headerlink" title="è’¸ç´«è–¯"></a>è’¸ç´«è–¯</h3><p>ç´ æ:</p><ul><li>ç´«è–¯</li></ul><p>è¿‡ç¨‹</p><ol><li><p>åˆ‡å—</p></li><li><p>è’¸ 10-20 åˆ†é’Ÿ</p></li><li><p>å»çš®æ…ç¢å³å¯</p></li></ol><h3 id="ç…é¸¡èƒ¸è‚‰"><a href="#ç…é¸¡èƒ¸è‚‰" class="headerlink" title="ç…é¸¡èƒ¸è‚‰"></a>ç…é¸¡èƒ¸è‚‰</h3><p>ç´ æ:</p><ul><li>é¸¡èƒ¸</li></ul><p>è¿‡ç¨‹</p><ol><li><p>è§£å†», å®¤æ¸©æˆ–è€…æµæ°´</p></li><li><p>åˆ‡ç‰‡æˆ–å—, æ›´å®¹æ˜“ç…, ç„¶åå€’å…¥ç”ŸæŠ½, æ–™é…’å’Œè€—æ²¹è…Œåˆ¶ 30 åˆ†é’Ÿ</p><ul><li>ç”ŸæŠ½, æ–™é…’, è€—æ²¹è…Œåˆ¶</li><li>é»‘èƒ¡æ¤’, æµ·ç›</li><li>ç›, èƒ¡æ¤’, å¡çœŸç²‰</li></ul></li><li><p>å¤§ç«ç…è‡³ä¸¤é¢é‡‘é»„è‰²</p></li></ol><h3 id="æ„é¢"><a href="#æ„é¢" class="headerlink" title="æ„é¢"></a>æ„é¢</h3><p>ç´ æ</p><ul><li>æ„é¢</li><li>å‘³å¥½ç¾æ„é¢é…±</li><li>ç‰›è‚‰ç¢</li><li>ç•ªèŒ„</li></ul><p>è¿‡ç¨‹</p><ol><li>æ²¸æ°´ç…® 10 åˆ†é’Ÿ, åŠ ä¸€ç‚¹ç›, æå‡ºæŠ¹æ©„æ¦„æ²¹å¤‡ç”¨</li><li>æ–™é…’, æ·€ç²‰è…Œåˆ¶ä¸‹ç‰›è‚‰ç¢, æ”¾å…¥ç‚’é”…å¼€å§‹ç‚’</li><li>è‚‰è‰²å˜åŒ–åæ”¾å…¥ç•ªèŒ„</li><li>ç•ªèŒ„å·®ä¸å¤šæ”¾å…¥æ„é¢é…±, å€’å…¥200ml æ°´, å°ç«ç„–ç…®</li><li>æ”¾å…¥æ„é¢ç‚’å·®ä¸å¤šå¯ä»¥å‡ºé”…äº†</li><li>æœ€åæ”¾ç‚¹é»‘èƒ¡æ¤’, å‘³é“ä¸å¤Ÿå¯ä»¥åŠ ç‚¹é»‘èƒ¡æ¤’é…±</li></ol><h3 id="ç‡•éº¦ç‰‡"><a href="#ç‡•éº¦ç‰‡" class="headerlink" title="ç‡•éº¦ç‰‡"></a>ç‡•éº¦ç‰‡</h3><p>ç´ æ</p><ul><li>ç‡•éº¦ç‰‡</li><li>ç‰›å¥¶</li><li>é¦™è•‰</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¡¬ä»¶&quot;&gt;&lt;a href=&quot;#ç¡¬ä»¶&quot; class=&quot;headerlink&quot; title=&quot;ç¡¬ä»¶&quot;&gt;&lt;/a&gt;ç¡¬ä»¶&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ç”µé¥­é”…&lt;/li&gt;
&lt;li&gt;ç”µç£ç‚‰: ç±³å®¶ç”µç£ç‚‰é’æ˜¥ç‰ˆ&lt;/li&gt;
&lt;li&gt;ç…é”…, é›ªå¹³é”…&lt;/li&gt;
&lt;li&gt;å¨æˆ¿çº¸&lt;/li&gt;
&lt;l
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»" scheme="http://taizilongxu.github.io/wiki/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>Float</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythonFloat/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythonFloat/</id>
    <published>2020-03-28T18:08:55.000Z</published>
    <updated>2020-03-28T18:10:09.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>ä»£ç ä½ç½®: <code>Include/floatobject.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject_HEAD</span><br><span class="line">    <span class="keyword">double</span> ob_fval;</span><br><span class="line">&#125; PyFloatObject;</span><br></pre></td></tr></table></figure><h3 id="Typeç±»å‹"><a href="#Typeç±»å‹" class="headerlink" title="Typeç±»å‹"></a>Typeç±»å‹</h3><p>ä»£ç ä½ç½®: <code>Objects/floatobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PyTypeObject PyFloat_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"float"</span>,</span><br><span class="line">    <span class="keyword">sizeof</span>(PyFloatObject),</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    (destructor)float_dealloc,                  <span class="comment">/* tp_dealloc */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    (reprfunc)float_repr,                       <span class="comment">/* tp_repr */</span></span><br><span class="line"></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_init */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_alloc */</span></span><br><span class="line">    float_new,                                  <span class="comment">/* tp_new */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Float çœ‹æ¥æ²¡å•¥ä¸œè¥¿</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç»“æ„&quot;&gt;&lt;a href=&quot;#ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ç»“æ„&quot;&gt;&lt;/a&gt;ç»“æ„&lt;/h3&gt;&lt;p&gt;ä»£ç ä½ç½®: &lt;code&gt;Include/floatobject.h&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight 
      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>String</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythonString/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythonString/</id>
    <published>2020-03-28T18:03:41.000Z</published>
    <updated>2020-03-28T18:03:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™:</p><ul><li><p><a href="https://www.python.org/dev/peps/pep-0393/" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-0393/</a></p></li><li><p><a href="https://docs.python.org/3/c-api/unicode.html#creating-and-accessing-unicode-strings" target="_blank" rel="noopener">https://docs.python.org/3/c-api/unicode.html#creating-and-accessing-unicode-strings</a></p></li><li><p><a href="https://rushter.com/blog/python-strings-and-memory/" target="_blank" rel="noopener">https://rushter.com/blog/python-strings-and-memory/</a></p></li><li><p><a href="https://timothybramlett.com/Strings_Bytes_and_Unicode_in_Python_2_and_3.html" target="_blank" rel="noopener">https://timothybramlett.com/Strings_Bytes_and_Unicode_in_Python_2_and_3.html</a></p></li><li><p><a href="https://nedbatchelder.com/text/unipain.html" target="_blank" rel="noopener">https://nedbatchelder.com/text/unipain.html</a></p></li><li><p><a href="https://www.cnblogs.com/c-x-a/p/11408372.html" target="_blank" rel="noopener">https://www.cnblogs.com/c-x-a/p/11408372.html</a></p></li></ul><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_string.png" alt=""></p><p>compact å’Œ legacy</p><ul><li>compact: åˆ›å»ºçš„æ—¶å€™çŸ¥é“é•¿åº¦å’Œæœ€å¤§ character çš„ä½¿ç”¨ compact, character ç´§è·Ÿåœ¨ base structer åé¢, å¦‚æœæœ€å¤§ character å°äº 128 åˆ™ä½¿ç”¨ PyASCIIObject ç»“æ„, å¦‚æœå¤§äº 128 åˆ™ä½¿ç”¨ PyCompactUnicodeObject</li><li>legacy: åˆ›å»ºçš„æ—¶å€™ä¸çŸ¥é“æœ€å¤§ character çš„ä½¿ç”¨ legacy, ä½¿ç”¨ PyUnicode_FromStringAndSize(NULL, length) åˆ›å»º, åœ¨å†…éƒ¨ä»–ä»¬çš„æ•°æ®åªä¿å­˜åœ¨  wstr é‡Œé¢. å½“ PyUnicode_READY è¢«è°ƒç”¨, data pointer å°±è¢«åˆ†é…äº†. Resizing åªèƒ½åœ¨PyUnicode_READY ä¹‹å‰è°ƒç”¨.</li></ul><p>kind</p><ul><li>00 =&gt; str is not initialized (data are in wstr)</li><li>01 =&gt; 1 byte (Latin-1)</li><li>10 =&gt; 2 byte (UCS-2)</li><li>11 =&gt; 4 byte (UCS-4)</li></ul><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>ä»£ç ä½ç½®: <code>Include/cpython/unicodeobject.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* ASCII-only strings created through PyUnicode_New use the PyASCIIObject</span></span><br><span class="line"><span class="comment">   structure. state.ascii and state.compact are set, and the data</span></span><br><span class="line"><span class="comment">   immediately follow the structure. utf8_length and wstr_length can be found</span></span><br><span class="line"><span class="comment">   in the length field; the utf8 pointer is equal to the data pointer. */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="comment">/* There are 4 forms of Unicode strings:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - compact ascii:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         * structure = PyASCIIObject</span></span><br><span class="line"><span class="comment">         * test: PyUnicode_IS_COMPACT_ASCII(op)</span></span><br><span class="line"><span class="comment">         * kind = PyUnicode_1BYTE_KIND</span></span><br><span class="line"><span class="comment">         * compact = 1</span></span><br><span class="line"><span class="comment">         * ascii = 1</span></span><br><span class="line"><span class="comment">         * ready = 1</span></span><br><span class="line"><span class="comment">         * (length is the length of the utf8 and wstr strings)</span></span><br><span class="line"><span class="comment">         * (data starts just after the structure)</span></span><br><span class="line"><span class="comment">         * (since ASCII is decoded from UTF-8, the utf8 string are the data)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - compact:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         * structure = PyCompactUnicodeObject</span></span><br><span class="line"><span class="comment">         * test: PyUnicode_IS_COMPACT(op) &amp;&amp; !PyUnicode_IS_ASCII(op)</span></span><br><span class="line"><span class="comment">         * kind = PyUnicode_1BYTE_KIND, PyUnicode_2BYTE_KIND or</span></span><br><span class="line"><span class="comment">           PyUnicode_4BYTE_KIND</span></span><br><span class="line"><span class="comment">         * compact = 1</span></span><br><span class="line"><span class="comment">         * ready = 1</span></span><br><span class="line"><span class="comment">         * ascii = 0</span></span><br><span class="line"><span class="comment">         * utf8 is not shared with data</span></span><br><span class="line"><span class="comment">         * utf8_length = 0 if utf8 is NULL</span></span><br><span class="line"><span class="comment">         * wstr is shared with data and wstr_length=length</span></span><br><span class="line"><span class="comment">           if kind=PyUnicode_2BYTE_KIND and sizeof(wchar_t)=2</span></span><br><span class="line"><span class="comment">           or if kind=PyUnicode_4BYTE_KIND and sizeof(wchar_t)=4</span></span><br><span class="line"><span class="comment">         * wstr_length = 0 if wstr is NULL</span></span><br><span class="line"><span class="comment">         * (data starts just after the structure)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - legacy string, not ready:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         * structure = PyUnicodeObject</span></span><br><span class="line"><span class="comment">         * test: kind == PyUnicode_WCHAR_KIND</span></span><br><span class="line"><span class="comment">         * length = 0 (use wstr_length)</span></span><br><span class="line"><span class="comment">         * hash = -1</span></span><br><span class="line"><span class="comment">         * kind = PyUnicode_WCHAR_KIND</span></span><br><span class="line"><span class="comment">         * compact = 0</span></span><br><span class="line"><span class="comment">         * ascii = 0</span></span><br><span class="line"><span class="comment">         * ready = 0</span></span><br><span class="line"><span class="comment">         * interned = SSTATE_NOT_INTERNED</span></span><br><span class="line"><span class="comment">         * wstr is not NULL</span></span><br><span class="line"><span class="comment">         * data.any is NULL</span></span><br><span class="line"><span class="comment">         * utf8 is NULL</span></span><br><span class="line"><span class="comment">         * utf8_length = 0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       - legacy string, ready:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         * structure = PyUnicodeObject structure</span></span><br><span class="line"><span class="comment">         * test: !PyUnicode_IS_COMPACT(op) &amp;&amp; kind != PyUnicode_WCHAR_KIND</span></span><br><span class="line"><span class="comment">         * kind = PyUnicode_1BYTE_KIND, PyUnicode_2BYTE_KIND or</span></span><br><span class="line"><span class="comment">           PyUnicode_4BYTE_KIND</span></span><br><span class="line"><span class="comment">         * compact = 0</span></span><br><span class="line"><span class="comment">         * ready = 1</span></span><br><span class="line"><span class="comment">         * data.any is not NULL</span></span><br><span class="line"><span class="comment">         * utf8 is shared and utf8_length = length with data.any if ascii = 1</span></span><br><span class="line"><span class="comment">         * utf8_length = 0 if utf8 is NULL</span></span><br><span class="line"><span class="comment">         * wstr is shared with data.any and wstr_length = length</span></span><br><span class="line"><span class="comment">           if kind=PyUnicode_2BYTE_KIND and sizeof(wchar_t)=2</span></span><br><span class="line"><span class="comment">           or if kind=PyUnicode_4BYTE_KIND and sizeof(wchar_4)=4</span></span><br><span class="line"><span class="comment">         * wstr_length = 0 if wstr is NULL</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       Compact strings use only one memory block (structure + characters),</span></span><br><span class="line"><span class="comment">       whereas legacy strings use one block for the structure and one block</span></span><br><span class="line"><span class="comment">       for characters.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       Legacy strings are created by PyUnicode_FromUnicode() and</span></span><br><span class="line"><span class="comment">       PyUnicode_FromStringAndSize(NULL, size) functions. They become ready</span></span><br><span class="line"><span class="comment">       when PyUnicode_READY() is called.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       See also _PyUnicode_CheckConsistency().</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    PyObject_HEAD</span><br><span class="line">    Py_ssize_t length;          <span class="comment">/* Number of code points in the string */</span></span><br><span class="line">    Py_hash_t hash;             <span class="comment">/* Hash value; -1 if not set */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           SSTATE_NOT_INTERNED (0)</span></span><br><span class="line"><span class="comment">           SSTATE_INTERNED_MORTAL (1)</span></span><br><span class="line"><span class="comment">           SSTATE_INTERNED_IMMORTAL (2)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           If interned != SSTATE_NOT_INTERNED, the two references from the</span></span><br><span class="line"><span class="comment">           dictionary to this object are *not* counted in ob_refcnt.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> interned:<span class="number">2</span>;</span><br><span class="line">        <span class="comment">/* Character size:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           - PyUnicode_WCHAR_KIND (0):</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">             * character type = wchar_t (16 or 32 bits, depending on the</span></span><br><span class="line"><span class="comment">               platform)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           - PyUnicode_1BYTE_KIND (1):</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">             * character type = Py_UCS1 (8 bits, unsigned)</span></span><br><span class="line"><span class="comment">             * all characters are in the range U+0000-U+00FF (latin1)</span></span><br><span class="line"><span class="comment">             * if ascii is set, all characters are in the range U+0000-U+007F</span></span><br><span class="line"><span class="comment">               (ASCII), otherwise at least one character is in the range</span></span><br><span class="line"><span class="comment">               U+0080-U+00FF</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           - PyUnicode_2BYTE_KIND (2):</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">             * character type = Py_UCS2 (16 bits, unsigned)</span></span><br><span class="line"><span class="comment">             * all characters are in the range U+0000-U+FFFF (BMP)</span></span><br><span class="line"><span class="comment">             * at least one character is in the range U+0100-U+FFFF</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           - PyUnicode_4BYTE_KIND (4):</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">             * character type = Py_UCS4 (32 bits, unsigned)</span></span><br><span class="line"><span class="comment">             * all characters are in the range U+0000-U+10FFFF</span></span><br><span class="line"><span class="comment">             * at least one character is in the range U+10000-U+10FFFF</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> kind:<span class="number">3</span>;</span><br><span class="line">        <span class="comment">/* Compact is with respect to the allocation scheme. Compact unicode</span></span><br><span class="line"><span class="comment">           objects only require one memory block while non-compact objects use</span></span><br><span class="line"><span class="comment">           one block for the PyUnicodeObject struct and another for its data</span></span><br><span class="line"><span class="comment">           buffer. */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> compact:<span class="number">1</span>;</span><br><span class="line">        <span class="comment">/* The string only contains characters in the range U+0000-U+007F (ASCII)</span></span><br><span class="line"><span class="comment">           and the kind is PyUnicode_1BYTE_KIND. If ascii is set and compact is</span></span><br><span class="line"><span class="comment">           set, use the PyASCIIObject structure. */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> ascii:<span class="number">1</span>;</span><br><span class="line">        <span class="comment">/* The ready flag indicates whether the object layout is initialized</span></span><br><span class="line"><span class="comment">           completely. This means that this is either a compact object, or</span></span><br><span class="line"><span class="comment">           the data pointer is filled out. The bit is redundant, and helps</span></span><br><span class="line"><span class="comment">           to minimize the test in PyUnicode_IS_READY(). */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">ready</span>:<span class="number">1</span>;</span><br><span class="line">        <span class="comment">/* Padding to ensure that PyUnicode_DATA() is always aligned to</span></span><br><span class="line"><span class="comment">           4 bytes (see issue #19537 on m68k). */</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> :<span class="number">24</span>;</span><br><span class="line">    &#125; state;</span><br><span class="line">    <span class="keyword">wchar_t</span> *wstr;              <span class="comment">/* wchar_t representation (null-terminated) */</span></span><br><span class="line">&#125; PyASCIIObject;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Non-ASCII strings allocated through PyUnicode_New use the</span></span><br><span class="line"><span class="comment">   PyCompactUnicodeObject structure. state.compact is set, and the data</span></span><br><span class="line"><span class="comment">   immediately follow the structure. */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyASCIIObject _base;</span><br><span class="line">    Py_ssize_t utf8_length;     <span class="comment">/* Number of bytes in utf8, excluding the</span></span><br><span class="line"><span class="comment">                                 * terminating \0. */</span></span><br><span class="line">    <span class="keyword">char</span> *utf8;                 <span class="comment">/* UTF-8 representation (null-terminated) */</span></span><br><span class="line">    Py_ssize_t wstr_length;     <span class="comment">/* Number of code points in wstr, possible</span></span><br><span class="line"><span class="comment">                                 * surrogates count as two code points. */</span></span><br><span class="line">&#125; PyCompactUnicodeObject;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Strings allocated through PyUnicode_FromUnicode(NULL, len) use the</span></span><br><span class="line"><span class="comment">   PyUnicodeObject structure. The actual string data is initially in the wstr</span></span><br><span class="line"><span class="comment">   block, and copied into the data block using _PyUnicode_Ready. */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyCompactUnicodeObject _base;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> *any;</span><br><span class="line">        Py_UCS1 *latin1;</span><br><span class="line">        Py_UCS2 *ucs2;</span><br><span class="line">        Py_UCS4 *ucs4;</span><br><span class="line">    &#125; data;                     <span class="comment">/* Canonical, smallest-form Unicode buffer */</span></span><br><span class="line">&#125; PyUnicodeObject;</span><br></pre></td></tr></table></figure><p>ä»£ç ä½ç½®: <code>Objects/unicodeobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PyTypeObject PyUnicode_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"str"</span>,                        <span class="comment">/* tp_name */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(PyUnicodeObject),      <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_itemsize */</span></span><br><span class="line">    <span class="comment">/* Slots */</span></span><br><span class="line">    (destructor)unicode_dealloc,  <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_init */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_alloc */</span></span><br><span class="line">    unicode_new,                  <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_Del,                 <span class="comment">/* tp_free */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="C-æ¥å£"><a href="#C-æ¥å£" class="headerlink" title="C æ¥å£"></a>C æ¥å£</h3><p>ä»£ç ä½ç½®: <code>Objects/unicodeobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">PyObject *</span><br><span class="line">PyUnicode_New(Py_ssize_t <span class="built_in">size</span>, Py_UCS4 maxchar)</span><br><span class="line">&#123;</span><br><span class="line">    PyObject *obj;</span><br><span class="line">    PyCompactUnicodeObject *unicode;</span><br><span class="line">    <span class="keyword">void</span> *data;</span><br><span class="line">    <span class="keyword">enum</span> PyUnicode_Kind kind;</span><br><span class="line">    <span class="keyword">int</span> is_sharing, is_ascii;</span><br><span class="line">    Py_ssize_t char_size;</span><br><span class="line">    Py_ssize_t struct_size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Optimization for empty strings */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">0</span> &amp;&amp; unicode_empty != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Py_INCREF(unicode_empty);</span><br><span class="line">        <span class="keyword">return</span> unicode_empty;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    is_ascii = <span class="number">0</span>;</span><br><span class="line">    is_sharing = <span class="number">0</span>;</span><br><span class="line">    struct_size = <span class="keyword">sizeof</span>(PyCompactUnicodeObject);</span><br><span class="line">    <span class="keyword">if</span> (maxchar &lt; <span class="number">128</span>) &#123;</span><br><span class="line">        kind = PyUnicode_1BYTE_KIND;</span><br><span class="line">        char_size = <span class="number">1</span>;</span><br><span class="line">        is_ascii = <span class="number">1</span>;</span><br><span class="line">        struct_size = <span class="keyword">sizeof</span>(PyASCIIObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (maxchar &lt; <span class="number">256</span>) &#123;</span><br><span class="line">        kind = PyUnicode_1BYTE_KIND;</span><br><span class="line">        char_size = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (maxchar &lt; <span class="number">65536</span>) &#123;</span><br><span class="line">        kind = PyUnicode_2BYTE_KIND;</span><br><span class="line">        char_size = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">sizeof</span>(<span class="keyword">wchar_t</span>) == <span class="number">2</span>)</span><br><span class="line">            is_sharing = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (maxchar &gt; MAX_UNICODE) &#123;</span><br><span class="line">            PyErr_SetString(PyExc_SystemError,</span><br><span class="line">                            <span class="string">"invalid maximum character passed to PyUnicode_New"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        kind = PyUnicode_4BYTE_KIND;</span><br><span class="line">        char_size = <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">sizeof</span>(<span class="keyword">wchar_t</span>) == <span class="number">4</span>)</span><br><span class="line">            is_sharing = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Ensure we won't overflow the size. */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">size</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_SystemError,</span><br><span class="line">                        <span class="string">"Negative size passed to PyUnicode_New"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">size</span> &gt; ((PY_SSIZE_T_MAX - struct_size) / char_size - <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> PyErr_NoMemory();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Duplicated allocation code from _PyObject_New() instead of a call to</span></span><br><span class="line"><span class="comment">     * PyObject_New() so we are able to allocate space for the object and</span></span><br><span class="line"><span class="comment">     * it's data buffer.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    obj = (PyObject *) PyObject_MALLOC(struct_size + (<span class="built_in">size</span> + <span class="number">1</span>) * char_size);</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> PyErr_NoMemory();</span><br><span class="line">    obj = PyObject_INIT(obj, &amp;PyUnicode_Type);</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    unicode = (PyCompactUnicodeObject *)obj;</span><br><span class="line">    <span class="keyword">if</span> (is_ascii)</span><br><span class="line">        data = ((PyASCIIObject*)obj) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        data = unicode + <span class="number">1</span>;</span><br><span class="line">    _PyUnicode_LENGTH(unicode) = <span class="built_in">size</span>;</span><br><span class="line">    _PyUnicode_HASH(unicode) = <span class="number">-1</span>;</span><br><span class="line">    _PyUnicode_STATE(unicode).interned = <span class="number">0</span>;</span><br><span class="line">    _PyUnicode_STATE(unicode).kind = kind;</span><br><span class="line">    _PyUnicode_STATE(unicode).compact = <span class="number">1</span>;</span><br><span class="line">    _PyUnicode_STATE(unicode).<span class="built_in">ready</span> = <span class="number">1</span>;</span><br><span class="line">    _PyUnicode_STATE(unicode).ascii = is_ascii;</span><br><span class="line">    <span class="keyword">if</span> (is_ascii) &#123;</span><br><span class="line">        ((<span class="keyword">char</span>*)data)[<span class="built_in">size</span>] = <span class="number">0</span>;</span><br><span class="line">        _PyUnicode_WSTR(unicode) = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (kind == PyUnicode_1BYTE_KIND) &#123;</span><br><span class="line">        ((<span class="keyword">char</span>*)data)[<span class="built_in">size</span>] = <span class="number">0</span>;</span><br><span class="line">        _PyUnicode_WSTR(unicode) = <span class="literal">NULL</span>;</span><br><span class="line">        _PyUnicode_WSTR_LENGTH(unicode) = <span class="number">0</span>;</span><br><span class="line">        unicode-&gt;utf8 = <span class="literal">NULL</span>;</span><br><span class="line">        unicode-&gt;utf8_length = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        unicode-&gt;utf8 = <span class="literal">NULL</span>;</span><br><span class="line">        unicode-&gt;utf8_length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (kind == PyUnicode_2BYTE_KIND)</span><br><span class="line">            ((Py_UCS2*)data)[<span class="built_in">size</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">/* kind == PyUnicode_4BYTE_KIND */</span></span><br><span class="line">            ((Py_UCS4*)data)[<span class="built_in">size</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (is_sharing) &#123;</span><br><span class="line">            _PyUnicode_WSTR_LENGTH(unicode) = <span class="built_in">size</span>;</span><br><span class="line">            _PyUnicode_WSTR(unicode) = (<span class="keyword">wchar_t</span> *)data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            _PyUnicode_WSTR_LENGTH(unicode) = <span class="number">0</span>;</span><br><span class="line">            _PyUnicode_WSTR(unicode) = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> Py_DEBUG</span></span><br><span class="line">    unicode_fill_invalid((PyObject*)unicode, <span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    assert(_PyUnicode_CheckConsistency((PyObject*)unicode, <span class="number">0</span>));</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™è¾¹åªæ˜¯åˆå§‹åŒ–å†…å­˜ç©ºé—´, æ ¹æ®é•¿åº¦å’Œæœ€å¤§å­—ç¬¦æ¥è¿›è¡Œåˆå§‹åŒ–, åˆ†ä½ä¸¤ç§ PyCompactUnicodeObject å’Œ PyASCIIObject</p><h3 id="Intern"><a href="#Intern" class="headerlink" title="Intern"></a>Intern</h3><p>å…±äº«æœºåˆ¶, åªå¯¹å­—æ¯æ•°å­—ä¸‹åˆ’çº¿çš„å­—ç¬¦ä¸²è¿›è¡Œå…±äº«</p><p>è‡³æ­¤, æ„Ÿè§‰ç†è§£å·®ä¸å¤šäº†, å¯¹äºæ›´è¯¦ç»†çš„ç­‰æœ‰ç©ºå†æ¥è¡¥å……</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‚è€ƒèµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://www.python.org/dev/peps/pep-0393/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.python.org/dev/peps/
      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>Python å†…å»ºç±»å‹</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythonInternalObject/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythonInternalObject/</id>
    <published>2020-03-28T18:02:41.000Z</published>
    <updated>2020-03-28T18:02:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™:</p><ul><li><a href="https://flaggo.github.io/python3-source-code-analysis/objects/long-object/" target="_blank" rel="noopener">https://flaggo.github.io/python3-source-code-analysis/objects/long-object/</a></li></ul><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/pythonObject.png" alt=""></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">typeobject</span> &#123;</span></span><br><span class="line">    PyObject_VAR_HEAD</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *tp_name; <span class="comment">/* For printing, in format "&lt;module&gt;.&lt;name&gt;" */</span></span><br><span class="line">    Py_ssize_t tp_basicsize, tp_itemsize; <span class="comment">/* For allocation */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">/* Method suites for standard classes */</span></span><br><span class="line"></span><br><span class="line">    PyNumberMethods *tp_as_number;</span><br><span class="line">    PySequenceMethods *tp_as_sequence;</span><br><span class="line">    PyMappingMethods *tp_as_mapping;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">/* Functions to access object as input/output buffer */</span></span><br><span class="line">    PyBufferProcs *tp_as_buffer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125; PyTypeObject;</span><br></pre></td></tr></table></figure><ul><li>å­—æ®µ tp_as_number éç©ºï¼Œå› æ­¤ float å¯¹è±¡ <strong>æ”¯æŒæ•°å€¼å‹æ“ä½œ</strong> ï¼›</li><li>å­—æ®µ tp_as_sequence ä¸ºç©ºï¼Œå› æ­¤ float å¯¹è±¡ <strong>ä¸æ”¯æŒåºåˆ—å‹æ“ä½œ</strong> ï¼›</li><li>å­—æ®µ tp_as_mapping ä¸ºç©ºï¼Œå› æ­¤ float å¯¹è±¡ <strong>ä¸æ”¯æŒå…³è”å‹æ“ä½œ</strong> ï¼›</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‚è€ƒèµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://flaggo.github.io/python3-source-code-analysis/objects/long-object/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ht
      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>List</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythonList/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythonList/</id>
    <published>2020-03-28T17:45:08.000Z</published>
    <updated>2020-03-28T17:45:08.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table><thead><tr><th align="left">æ–¹æ³•</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td align="left">list.append(obj)</td><td>å•ä¸ªå…ƒç´ ç”¨ append</td></tr><tr><td align="left">list.count(obj)</td><td></td></tr><tr><td align="left">list.extend(seq)</td><td>é€šå¸¸ç”¨ + ä»£æ›¿, list + list</td></tr><tr><td align="left">list.insert(index, obj)</td><td></td></tr><tr><td align="left">list.pop([index=-1])</td><td></td></tr><tr><td align="left">list.remove(obj)</td><td></td></tr><tr><td align="left">list.reverse()</td><td>list[::-1]</td></tr><tr><td align="left">list.sort(cmp=None, key=None, reverse=False)</td><td>list.sort( key=lambda r: r[2])</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_list.png" alt=""></p><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>ä»£ç ä½ç½®: <code>Include/floatobject.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject_VAR_HEAD</span><br><span class="line">    <span class="comment">/* Vector of pointers to list elements.  list[0] is ob_item[0], etc. */</span></span><br><span class="line">    PyObject **ob_item;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ob_item contains space for 'allocated' elements.  The number</span></span><br><span class="line"><span class="comment">     * currently in use is ob_size.</span></span><br><span class="line"><span class="comment">     * Invariants:</span></span><br><span class="line"><span class="comment">     *     0 &lt;= ob_size &lt;= allocated</span></span><br><span class="line"><span class="comment">     *     len(list) == ob_size</span></span><br><span class="line"><span class="comment">     *     ob_item == NULL implies ob_size == allocated == 0</span></span><br><span class="line"><span class="comment">     * list.sort() temporarily sets allocated to -1 to detect mutations.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Items must normally not be NULL, except during construction when</span></span><br><span class="line"><span class="comment">     * the list is not yet visible outside the function that builds it.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Py_ssize_t allocated;</span><br><span class="line">&#125; PyListObject;</span><br></pre></td></tr></table></figure><ul><li>ob_size: åˆ—è¡¨å®é™…å¤§å°</li><li>allocated: å†…å­˜åˆ†é…å¤§å°</li></ul><h3 id="Type-ç±»å‹"><a href="#Type-ç±»å‹" class="headerlink" title="Type ç±»å‹"></a>Type ç±»å‹</h3><p>ä»£ç ä½ç½®: <code>Objects/listobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PyTypeObject PyList_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"list"</span>,</span><br><span class="line">    <span class="keyword">sizeof</span>(PyListObject),</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    (destructor)list_dealloc,                   <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    ...</span><br><span class="line">    (initproc)list___init__,                    <span class="comment">/* tp_init */</span></span><br><span class="line">    PyType_GenericAlloc,                        <span class="comment">/* tp_alloc */</span></span><br><span class="line">    PyType_GenericNew,                          <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_GC_Del,                            <span class="comment">/* tp_free */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¯¹è±¡è°ƒç”¨é“¾:</p><p>PyType_GenericNew -&gt; PyType_GenericAlloc -&gt; PyObject_INIT_VAR</p><p>çŒœæµ‹å› ä¸º List ä¸»è¦å­˜å‚¨ä¸ºåŠ¨æ€æ•°ç»„, å†…éƒ¨ç»“æ„ç›´æ¥ä½¿ç”¨ Generic åˆå§‹åŒ–äº†</p><h3 id="C-æ¥å£"><a href="#C-æ¥å£" class="headerlink" title="C æ¥å£"></a>C æ¥å£</h3><p>ä»£ç ä½ç½®: <code>Objects/listobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">PyObject *</span><br><span class="line">PyList_New(Py_ssize_t <span class="built_in">size</span>)</span><br><span class="line">&#123;</span><br><span class="line">    PyListObject *op;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">size</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        PyErr_BadInternalCall();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// numfree æ€»å…±80ä¸ª list å¯¹è±¡æ•°ç»„, å¯ä»¥å…±äº«</span></span><br><span class="line">    <span class="keyword">if</span> (numfree) &#123;</span><br><span class="line">        numfree--;</span><br><span class="line">        op = free_list[numfree];</span><br><span class="line">        _Py_NewReference((PyObject *)op);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        op = PyObject_GC_New(PyListObject, &amp;PyList_Type);</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">size</span> &lt;= <span class="number">0</span>)</span><br><span class="line">        op-&gt;ob_item = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        op-&gt;ob_item = (PyObject **) PyMem_Calloc(<span class="built_in">size</span>, <span class="keyword">sizeof</span>(PyObject *));</span><br><span class="line">        <span class="keyword">if</span> (op-&gt;ob_item == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            Py_DECREF(op);</span><br><span class="line">            <span class="keyword">return</span> PyErr_NoMemory();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Py_SET_SIZE(op, <span class="built_in">size</span>);</span><br><span class="line">    op-&gt;allocated = <span class="built_in">size</span>;</span><br><span class="line">    _PyObject_GC_TRACK(op);</span><br><span class="line">    <span class="keyword">return</span> (PyObject *) op;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> PyList_MAXFREELIST</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PyList_MAXFREELIST 80</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">static</span> PyListObject *free_list[PyList_MAXFREELIST];</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li><p>æœ¬è´¨æ˜¯<code>åŠ¨æ€æ•°ç»„</code></p></li><li><p>åˆ—è¡¨æœ€å¤§ä¸º <code>1 &lt;&lt; 64</code></p></li><li><p>æ¯æ¬¡ append ä¼šåˆ¤æ–­ç©ºé—´æ˜¯å¦è¶³å¤Ÿ, æ‰©å±•åŠæ³•:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/* cpython/Objects/listobject.c */</span><br><span class="line">/* ç©ºé—´å¢é•¿çš„è§„å¾‹æ˜¯:  <span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">35</span>, <span class="number">46</span>, <span class="number">58</span>, <span class="number">72</span>, <span class="number">88</span>, ... */</span><br><span class="line">/* å½“å‰çš„: new_allocated = <span class="number">5</span> + (<span class="number">5</span> &gt;&gt; <span class="number">3</span>) + <span class="number">3</span> = <span class="number">8</span> */</span><br><span class="line">new_allocated = (size_t)newsize + (newsize &gt;&gt; 3) + (newsize &lt; 9 ? 3 : 6);</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ pop æ–¹æ³•æ—¶æ¯æ¬¡éƒ½ä¼šè°ƒç”¨ resize å‡½æ•°, ä½†æ˜¯åªæœ‰æ–°ç”³è¯·ç©ºé—´æ¯”å½“å‰å·²æœ‰ç©ºé—´ä¸€åŠè¿˜å°çš„æ—¶å€™è¢«è°ƒç”¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/* cpython/Objects/listobject.c */</span><br><span class="line">/* allocated: 8, newsize: 3, 8 &gt;= 3 &amp;&amp; (3 &gt;= 4?), å·²ç»æ¯”ä¸€åŠè¿˜å°äº† */</span><br><span class="line"><span class="keyword">if</span> (allocated &gt;= newsize &amp;&amp; newsize &gt;= (allocated &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">    /* å¦‚æœå½“å‰ç©ºé—´æ²¡æœ‰æ¯”åŸç©ºé—´ä¸€åŠè¿˜å° */</span><br><span class="line">    assert(self-&gt;ob_item != NULL || newsize == 0);</span><br><span class="line">    /* åªæ›´æ”¹ ob_size è¿™ä¸ªå­—æ®µé‡Œçš„å€¼å³å¯ */</span><br><span class="line">    Py_SIZE(self) = newsize;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">/* ... */</span><br><span class="line">/* <span class="number">3</span> + (<span class="number">3</span> &gt;&gt; <span class="number">3</span>) + <span class="number">3</span> = <span class="number">6</span> */</span><br><span class="line">new_allocated = (size_t)newsize + (newsize &gt;&gt; 3) + (newsize &lt; 9 ? 3 : 6);</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å¸¸ç”¨æ–¹æ³•&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨æ–¹æ³•&quot;&gt;&lt;/a&gt;å¸¸ç”¨æ–¹æ³•&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;å¤‡æ³¨&lt;/th&gt;
&lt;/tr&gt;
&lt;
      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>unicode å’Œ UTF-8</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/%E6%9D%82%E9%A1%B9/unicode/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/%E6%9D%82%E9%A1%B9/unicode/</id>
    <published>2020-03-25T17:11:43.000Z</published>
    <updated>2020-05-27T13:21:18.222Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™:</p><ul><li><a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html</a></li><li><a href="https://www.edc4it.com/blog/general/character-encoding-unicode-utf-8-and-a-bit-of-chauvinism-explained-for-the-masses-2" target="_blank" rel="noopener">https://www.edc4it.com/blog/general/character-encoding-unicode-utf-8-and-a-bit-of-chauvinism-explained-for-the-masses-2</a></li></ul><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/unicode.png" alt=""></p><h3 id="BOM"><a href="#BOM" class="headerlink" title="BOM"></a>BOM</h3><p>Byte order Mark æ ‡è®°æ–‡æœ¬å¤§å°ç«¯</p><ul><li>UTF-8 ä¸éœ€è¦ BOM, å› ä¸ºæœ¬èº«ç¼–ç æœºåˆ¶å¯ä»¥è¯†åˆ«</li><li>UTF-16 å’Œ UTF-32 éœ€è¦ BOM</li><li>BOM å­˜åœ¨äºå¾®è½¯ç³»ç»Ÿä¸­, Linux, Mac æ— éœ€è€ƒè™‘</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‚è€ƒèµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://ww
      
    
    </summary>
    
    
      <category term="æ‚é¡¹" scheme="http://taizilongxu.github.io/wiki/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
  </entry>
  
  <entry>
    <title>Python2 ç¼–ç é”™è¯¯æ±‡æ€»</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythonStringError/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythonStringError/</id>
    <published>2020-03-24T18:00:57.000Z</published>
    <updated>2020-03-24T18:01:26.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_unicode_str.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/taizilongxu/img/master/img/python_unicode_str.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>Int</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythonInt/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythonInt/</id>
    <published>2020-03-21T05:02:06.000Z</published>
    <updated>2020-04-03T18:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‚è€ƒèµ„æ–™:</p><ul><li><a href="https://he11olx.com/2018/07/14/1.CPython3.6æºç åˆ†æ/1.1.Pythonæ•´æ•°å¯¹è±¡/" target="_blank" rel="noopener">https://he11olx.com/2018/07/14/1.CPython3.6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/1.1.Python%E6%95%B4%E6%95%B0%E5%AF%B9%E8%B1%A1/</a></li><li><a href="https://flaggo.github.io/python3-source-code-analysis/objects/long-object/" target="_blank" rel="noopener">https://flaggo.github.io/python3-source-code-analysis/objects/long-object/</a></li><li><a href="https://rushter.com/blog/python-integer-implementation/" target="_blank" rel="noopener">https://rushter.com/blog/python-integer-implementation/</a></li></ul><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_long.png" alt=""></p><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>ä»£ç ä½ç½®: <code>Include/longintrepr.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">longobject</span> &#123;</span></span><br><span class="line">PyObject_VAR_HEAD</span><br><span class="line">digit ob_digit[<span class="number">1</span>];    <span class="comment">// digit ä¸å¹³å°ç›¸å…³ï¼Œé•¿åº¦ä¸ä¸€è‡´</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨æ ¼å¼"><a href="#å­˜å‚¨æ ¼å¼" class="headerlink" title="å­˜å‚¨æ ¼å¼"></a>å­˜å‚¨æ ¼å¼</h3><p><code>SUM(for i=0 through abs(ob_size)-1) ob_digit[i] * 2**(SHIFT*i)</code></p><p>ä¾‹å¦‚ 9223372043297226753 å¯ä»¥è¡¨ç¤ºä¸º<br>$$<br>1 * (2^{30})^0 + 6 * (2^{30})^1 + 8 *(2^{30})^2<br>$$<br>åœ¨ Python å†…éƒ¨è¡¨ç¤ºä¸º<br>ob_size: 3</p><p>ob_digit: [1, 6, 8]</p><p>Pylong_SHIFT: 30</p><p><a href="https://github.com/python/cpython/blob/865e4b4f630e2ae91e61239258abb58b488f1d65/Include/longintrepr.h#L9" target="_blank" rel="noopener">å…³äº PyLong_SHIFT å–å€¼åŸå› </a></p><h3 id="Type-ç±»å‹"><a href="#Type-ç±»å‹" class="headerlink" title="Type ç±»å‹"></a>Type ç±»å‹</h3><p>ä»£ç ä½ç½®: <code>Objects/longobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PyTypeObject PyLong_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"int"</span>,                                      <span class="comment">/* tp_name */</span></span><br><span class="line">    offsetof(PyLongObject, ob_digit),           <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(digit),                              <span class="comment">/* tp_itemsize */</span></span><br><span class="line">        ...</span><br><span class="line">    &amp;long_as_number,                            <span class="comment">/* tp_as_number */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_sequence */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_mapping */</span></span><br><span class="line">    long_new,                                   <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_Del,                               <span class="comment">/* tp_free */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="New-åˆå§‹åŒ–"><a href="#New-åˆå§‹åŒ–" class="headerlink" title="New åˆå§‹åŒ–"></a>New åˆå§‹åŒ–</h3><p>ä»£ç ä½ç½®: <code>Objects/clinic/longobject.c.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">long_new_impl(PyTypeObject *type, PyObject *x, PyObject *obase);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">long_new(PyTypeObject *type, PyObject *args, PyObject *kwargs)</span><br><span class="line">&#123;</span><br><span class="line">    PyObject *return_value = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> * <span class="keyword">const</span> _keywords[] = &#123;<span class="string">""</span>, <span class="string">"base"</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="keyword">static</span> _PyArg_Parser _parser = &#123;<span class="string">"|OO:int"</span>, _keywords, <span class="number">0</span>&#125;;</span><br><span class="line">    PyObject *x = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *obase = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!_PyArg_ParseTupleAndKeywordsFast(args, kwargs, &amp;_parser,</span><br><span class="line">        &amp;x, &amp;obase)) &#123;</span><br><span class="line">        <span class="keyword">goto</span> <span class="built_in">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    return_value = long_new_impl(type, x, obase);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span>:</span><br><span class="line">    <span class="keyword">return</span> return_value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç ä½ç½®: <code>Objects/longobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">long_new_impl(PyTypeObject *type, PyObject *x, PyObject *obase)</span><br><span class="line"><span class="comment">/*[clinic end generated code: output=e47cfe777ab0f24c input=81c98f418af9eb6f]*/</span></span><br><span class="line">&#123;</span><br><span class="line">    Py_ssize_t base;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type != &amp;PyLong_Type)</span><br><span class="line">        <span class="keyword">return</span> long_subtype_new(type, x, obase); <span class="comment">/* Wimp out */</span></span><br><span class="line">    <span class="keyword">if</span> (x == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (obase != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            PyErr_SetString(PyExc_TypeError,</span><br><span class="line">                            <span class="string">"int() missing string argument"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> PyLong_FromLong(<span class="number">0L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (obase == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> PyNumber_Long(x);</span><br><span class="line"></span><br><span class="line">    base = PyNumber_AsSsize_t(obase, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (base == <span class="number">-1</span> &amp;&amp; PyErr_Occurred())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> ((base != <span class="number">0</span> &amp;&amp; base &lt; <span class="number">2</span>) || base &gt; <span class="number">36</span>) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_ValueError,</span><br><span class="line">                        <span class="string">"int() base must be &gt;= 2 and &lt;= 36, or 0"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyUnicode_Check(x))</span><br><span class="line">        <span class="keyword">return</span> PyLong_FromUnicodeObject(x, (<span class="keyword">int</span>)base);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (PyByteArray_Check(x) || PyBytes_Check(x)) &#123;</span><br><span class="line">        <span class="keyword">char</span> *<span class="built_in">string</span>;</span><br><span class="line">        <span class="keyword">if</span> (PyByteArray_Check(x))</span><br><span class="line">            <span class="built_in">string</span> = PyByteArray_AS_STRING(x);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">string</span> = PyBytes_AS_STRING(x);</span><br><span class="line">        <span class="keyword">return</span> _PyLong_FromBytes(<span class="built_in">string</span>, Py_SIZE(x), (<span class="keyword">int</span>)base);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        PyErr_SetString(PyExc_TypeError,</span><br><span class="line">                        <span class="string">"int() can't convert non-string with explicit base"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>x == NULL ä¸” obase != NULL è°ƒç”¨ PyLong_FromLong</li><li>obase ä¸º NULL è°ƒç”¨ PyNumber_Long</li><li>x å’Œ obase éƒ½ä¸ä¸º NULL<ul><li>PyUnicode è°ƒç”¨ PyLong_FromUnicodeObjectï¼Œæœ€ç»ˆè°ƒç”¨ PyLong_FromString</li><li>PyByteArray/PyBytes è°ƒç”¨_PyLong_FromBytesï¼Œæœ€ç»ˆè°ƒç”¨ PyLong_FromString</li></ul></li></ul><h3 id="C-æ¥å£"><a href="#C-æ¥å£" class="headerlink" title="C æ¥å£"></a>C æ¥å£</h3><p>ä»£ç ä½ç½®: <code>Include/longobject.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromLong</span><span class="params">(<span class="keyword">long</span> v)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromUnsignedLong</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> v)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromSsize_t</span><span class="params">(Py_ssize_t v)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromSize_t</span><span class="params">(<span class="keyword">size_t</span> v)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromLongLong</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> v)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromUnsignedLongLong</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> v)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromDouble</span><span class="params">(<span class="keyword">double</span> v)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromString</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *str, <span class="keyword">char</span> **pend, <span class="keyword">int</span> base)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromUnicode</span><span class="params">(Py_UNICODE *u, Py_ssize_t length, <span class="keyword">int</span> base)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromUnicodeObject</span><span class="params">(PyObject *u, <span class="keyword">int</span> base)</span></span></span><br><span class="line"><span class="function">PyObject* <span class="title">PyLong_FromVoidPtr</span><span class="params">(<span class="keyword">void</span> *p)</span></span></span><br></pre></td></tr></table></figure><p>ä»£ç ä½ç½®: <code>Objects/longobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PyObject *</span><br><span class="line">PyLong_FromLong(<span class="keyword">long</span> ival)</span><br><span class="line">&#123;</span><br><span class="line">    PyLongObject *v;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> abs_ival;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> t;  <span class="comment">/* unsigned so &gt;&gt; doesn't propagate sign bit */</span></span><br><span class="line">    <span class="keyword">int</span> ndigits = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> sign;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (IS_SMALL_INT(ival)) &#123;</span><br><span class="line">        <span class="keyword">return</span> get_small_int((sdigit)ival);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Fast path for single-digit ints */</span></span><br><span class="line">    <span class="keyword">if</span> (!(abs_ival &gt;&gt; PyLong_SHIFT)) &#123;</span><br><span class="line">        v = _PyLong_New(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (v) &#123;</span><br><span class="line">            Py_SET_SIZE(v, sign);</span><br><span class="line">            v-&gt;ob_digit[<span class="number">0</span>] = Py_SAFE_DOWNCAST(</span><br><span class="line">                abs_ival, <span class="keyword">unsigned</span> <span class="keyword">long</span>, digit);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (PyObject*)v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>small_ints æ•°ç»„é•¿åº¦ï¼Œé»˜è®¤<code>[-5, 256]</code></li><li>å°æ•´å‹ä¼šç¼“å­˜, åªå¢åŠ å¼•ç”¨</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‚è€ƒèµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://he11olx.com/2018/07/14/1.CPython3.6æºç åˆ†æ/1.1.Pythonæ•´æ•°å¯¹è±¡/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://he11o
      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>Python Object</title>
    <link href="http://taizilongxu.github.io/wiki/wiki/Python/pythonObject/"/>
    <id>http://taizilongxu.github.io/wiki/wiki/Python/pythonObject/</id>
    <published>2020-03-19T17:28:04.000Z</published>
    <updated>2020-03-19T17:28:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>èµ„æ–™:</p><ul><li><a href="https://github.com/zpoint/CPython-Internals" target="_blank" rel="noopener">https://github.com/zpoint/CPython-Internals</a></li><li><a href="https://python.fasionchan.com/zh_CN/latest/source/object-model/pyobject.html" target="_blank" rel="noopener">https://python.fasionchan.com/zh_CN/latest/source/object-model/pyobject.html</a></li><li><a href="https://blog.csdn.net/Lzs1998/article/details/103907147?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">https://blog.csdn.net/Lzs1998/article/details/103907147?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</a></li></ul><p>å½“å‰ç‰ˆæœ¬ä»£ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/python/cpython.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> cpython</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard 6672c16b1d7f83789bf3a2016bd19edfd3568e71</span></span><br></pre></td></tr></table></figure><h2 id="PyObject"><a href="#PyObject" class="headerlink" title="PyObject"></a>PyObject</h2><p>ä»£ç åœ°å€: <code>Include/object.h</code></p><p>å®šé•¿å¯¹è±¡ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">object</span> &#123;</span></span><br><span class="line">    _PyObject_HEAD_EXTRA</span><br><span class="line">    Py_ssize_t ob_refcnt;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">typeobject</span> *<span class="title">ob_type</span>;</span></span><br><span class="line">&#125; PyObject;</span><br></pre></td></tr></table></figure><ul><li>_PyObject_HEAD_EXTRA: Debug ç”¨, å¯ä»¥å¿½ç•¥</li><li>ob_refnt: å¼•ç”¨è®¡æ•°, åƒåœ¾å›æ”¶ä½¿ç”¨</li><li>ob_type: ç±»å‹æŒ‡é’ˆ, æŒ‡å‘å¯¹è±¡çš„ç±»å‹å¯¹è±¡</li></ul><p>å˜é•¿å¯¹è±¡</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject ob_base;</span><br><span class="line">    Py_ssize_t ob_size; <span class="comment">/* Number of items in variable part */</span></span><br><span class="line">&#125; PyVarObject;</span><br></pre></td></tr></table></figure><h2 id="PyTypeObject"><a href="#PyTypeObject" class="headerlink" title="PyTypeObject"></a>PyTypeObject</h2><p>ä»£ç ä½ç½®: <code>Include/cpython/object.h</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">typeobject</span> &#123;</span></span><br><span class="line">    PyObject_VAR_HEAD</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *tp_name; <span class="comment">/* For printing, in format "&lt;module&gt;.&lt;name&gt;" */</span></span><br><span class="line">    Py_ssize_t tp_basicsize, tp_itemsize; <span class="comment">/* For allocation */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Methods to implement standard operations */</span></span><br><span class="line">    destructor tp_dealloc;</span><br><span class="line">    printfunc tp_print;</span><br><span class="line"></span><br><span class="line">    getattrfunc tp_getattr;</span><br><span class="line">    setattrfunc tp_setattr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">/* Attribute descriptor and subclassing stuff */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">typeobject</span> *<span class="title">tp_base</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125; PyTypeObject;</span><br></pre></td></tr></table></figure><ul><li>tp_name: ç±»å‹åç§°</li><li>tp_basicsize, tp_itemsize: åˆ›å»ºå®ä¾‹å¯¹è±¡æ‰€éœ€å†…å­˜ä¿¡æ¯</li><li>tp_print, tp_getattr: è¯¥ç±»å‹æ”¯æŒçš„ç›¸å…³æ“ä½œä¿¡æ¯</li></ul><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_struct.png" alt=""></p><h2 id="PyType-Type-type"><a href="#PyType-Type-type" class="headerlink" title="PyType_Type(type)"></a>PyType_Type(type)</h2><p>ä»£ç ä½ç½®: <code>Objects/typeobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PyTypeObject PyType_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"type"</span>,                                     <span class="comment">/* tp_name */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(PyHeapTypeObject),                   <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(PyMemberDef),                        <span class="comment">/* tp_itemsize */</span></span><br><span class="line">    (destructor)type_dealloc,                   <span class="comment">/* tp_dealloc */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    (reprfunc)type_repr,                        <span class="comment">/* tp_repr */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å†…å»ºç±»å‹å’Œè‡ªå®šä¹‰ç±»å¯¹åº”çš„ <code>PyTypeObject</code> éƒ½æ˜¯é€šè¿‡ <code>PyTypeType</code> åˆ›å»ºçš„, è¢«ç§°ä½œ <code>å…ƒç±»å‹(meta class)</code></li><li><code>PyType_Type</code> å°†è‡ªå·±çš„ ob_type è®¾ç½®æˆè‡ªå·±</li></ul><h2 id="PyBaseObject-Type-object"><a href="#PyBaseObject-Type-object" class="headerlink" title="PyBaseObject_Type(object)"></a>PyBaseObject_Type(object)</h2><p>ä»£ç ä½ç½®: <code>Objects/typeobject.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PyTypeObject PyBaseObject_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"object"</span>,                                   <span class="comment">/* tp_name */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(PyObject),                           <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_itemsize */</span></span><br><span class="line">    object_dealloc,                             <span class="comment">/* tp_dealloc */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    object_repr,                                <span class="comment">/* tp_repr */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_type_object.png" alt=""></p><p>æ€»ç»“</p><ul><li>Type æ˜¯æ‰€æœ‰å®ä¾‹åŒ–å¯¹è±¡çš„çˆ¸çˆ¸</li><li>Object æ˜¯ä¸ºäº†ç¡®è®¤ç±»å’Œçˆ¶ç±»çš„å…³ç³»åœ¨åˆ›å»ºå¯¹è±¡æ—¶</li></ul><h2 id="åˆ›å»ºå¯¹è±¡è¿‡ç¨‹"><a href="#åˆ›å»ºå¯¹è±¡è¿‡ç¨‹" class="headerlink" title="åˆ›å»ºå¯¹è±¡è¿‡ç¨‹"></a>åˆ›å»ºå¯¹è±¡è¿‡ç¨‹</h2><p><code>pi = float(&#39;3.14&#39;)</code> é€šè¿‡ Python çš„ interpreter æˆ‘ä»¬å¯ä»¥ç¿»è¯‘å‡ºè¿™ä¸ªè¯­å¥æ˜¯å®ä¾‹åŒ– float çš„è¿‡ç¨‹, è¿™ä¸ªè¿‡ç¨‹å³ type æ¥ç»Ÿä¸€åˆ›å»ºå¯¹è±¡çš„æµç¨‹(å¯ä»¥é€šè¿‡å­¦ä¹  Cpython åŠ æ·±ç†è§£)</p><p><img src="https://raw.githubusercontent.com/taizilongxu/img/master/img/python_object_create.png" alt=""></p><ol><li>è°ƒç”¨ float ï¼Œ Python æœ€ç»ˆæ‰§è¡Œå…¶ç±»å‹å¯¹è±¡ type çš„ tp_call å‡½æ•°ï¼›</li><li>tp_call å‡½æ•°è°ƒç”¨ float çš„ tp_new å‡½æ•°ä¸ºå®ä¾‹å¯¹è±¡åˆ†é… <strong>å†…å­˜ç©ºé—´</strong> ï¼›</li><li>tp_call å‡½æ•°å¿…è¦æ—¶è¿›ä¸€æ­¥è°ƒç”¨ tp_init å‡½æ•°å¯¹å®ä¾‹å¯¹è±¡è¿›è¡Œ <strong>åˆå§‹åŒ–</strong> ï¼›</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;èµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/zpoint/CPython-Internals&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/zpoint/CPython-I
      
    
    </summary>
    
    
      <category term="Python" scheme="http://taizilongxu.github.io/wiki/categories/Python/"/>
    
    
  </entry>
  
</feed>
